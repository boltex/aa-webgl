<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Sheet Converter</title>
</head>

<body>
    <button id="saveButton">Save Output</button>
    <span id="dimensionsInfo"></span>
    <br>
    <canvas id="outputCanvas" style="display: none;"></canvas>
    <br>
    <canvas id="sourceCanvas" style="display: none;"></canvas>

    <script>
        // Step 1: Load the image into the first canvas
        const spriteSheet = new Image();
        spriteSheet.src = 'plancher2.png'; // Update with your sprite sheet path
        spriteSheet.onload = () => {
            const sourceCanvas = document.getElementById('sourceCanvas');
            const sourceCtx = sourceCanvas.getContext('2d');

            // Set source canvas size to match the sprite sheet dimensions
            sourceCanvas.width = spriteSheet.width;
            sourceCanvas.height = spriteSheet.height;
            sourceCtx.drawImage(spriteSheet, 0, 0);

            // Step 2: Create the output canvas and rearrange the sprites
            const spriteWidth = 64; // Width of a single sprite
            const spriteHeight = 64; // Height of a single sprite
            const spritesPerRow = spriteSheet.width / spriteWidth; // Calculate sprites per row

            // individual sprites are 64pixels square.
            // 16 x 16 sprites subsheets in a 4x4 total sheet of 4096 x 4096 pixels

            const outputCanvas = document.getElementById('outputCanvas');
            const outputCtx = outputCanvas.getContext('2d');

            // Set output canvas dimensions
            const totalSprites = (spriteSheet.width / spriteWidth) * (spriteSheet.height / spriteHeight);
            outputCanvas.width = spriteWidth;
            outputCanvas.height = totalSprites * spriteHeight;

            // Rearrange sprites vertically
            let spriteIndex = 0;
            for (let y = 0; y < spriteSheet.height; y += spriteHeight) {
                for (let x = 0; x < spriteSheet.width; x += spriteWidth) {
                    const targetY = spriteIndex * spriteHeight; // Calculate the vertical position in the output canvas
                    outputCtx.drawImage(sourceCanvas, x, y, spriteWidth, spriteHeight, 0, targetY, spriteWidth, spriteHeight);
                    spriteIndex++;
                }
            }

            // Update dimensions info
            const dimensionsInfo = document.getElementById('dimensionsInfo');
            dimensionsInfo.textContent = `Original Image Size: ${spriteSheet.width}x${spriteSheet.height}, Output Image Size: ${outputCanvas.width}x${outputCanvas.height}, Sprite Width: ${spriteWidth}, Sprite Height: ${spriteHeight}`;
            dimensionsInfo.textContent = `Original Image Size: ${spriteSheet.width}x${spriteSheet.height}, Output Image Size: ${outputCanvas.width}x${outputCanvas.height}, Sprite Width: ${spriteWidth}, Sprite Height: ${spriteHeight}, Total Sprites: ${totalSprites}`;

        };

        // Step 4: Save the output canvas as an image
        document.getElementById('saveButton').addEventListener('click', () => {
            const outputCanvas = document.getElementById('outputCanvas');
            const dataURL = outputCanvas.toDataURL('image/png');

            // Create a link to download the image
            const link = document.createElement('a');
            link.href = dataURL;
            link.download = 'rearranged-spritesheet2.png';
            link.click();
        });
    </script>
</body>

</html>